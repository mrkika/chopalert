{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>ChopAlert - Food Spots Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1">

</head>

<body>

    <header>
        <h1>ChopAlert</h1>
        <p>Discover local street food spots around you</p>
        <a href="{% url 'post_spot' %}">üìç Post a Food Spot</a>
    </header>

    <form method="get" class="filter-form">
        <div class="filter-controls">
            <select name="type" class="filter-select">
                <option value="">üçΩÔ∏è All Foods</option>
                <option value="suya" {% if selected_type == "suya" %}selected{% endif %}>üî• Suya</option>
                <option value="akara" {% if selected_type == "akara" %}selected{% endif %}>ü•ô Akara</option>
                <option value="puffpuff" {% if selected_type == "puffpuff" %}selected{% endif %}>üç© Puff Puff</option>
                <option value="noodles" {% if selected_type == "noodles" %}selected{% endif %}>üçú Noodles</option>
                <option value="shawarma" {% if selected_type == "shawarma" %}selected{% endif %}>üåØ Shawarma</option>
                <option value="others" {% if selected_type == "others" %}selected{% endif %}>üßÉ Others</option>
            </select>
    
            <input type="text" name="search" class="search-input" placeholder="üîç Search description..."
                value="{{ search_query|default:'' }}">
    
            <button type="submit" class="filter-btn">Apply</button>
        </div>
    </form>
      
    
      

    <div class="map-container">
        <div id="map"></div>
    </div>

    <div class="container">
        
        </head>
        
        <body>
            <!-- ... map and link ... -->
        
            <h2 style="text-align: center; margin-top: 40px;">üç¥ Food Spots Around</h2>
        
            <div class="spot-grid">
                {% for spot in spots %}
                <div class="spot-card">
                    {% if spot.photo %}
                    <img src="{{ spot.photo.url }}" alt="Food Photo">
                    {% else %}
                    <img src="{% static 'images/bg2.jpg' %}" alt="No Image Available">
                    {% endif %}
                    <div class="spot-card-content">
                        <h3>{{ spot.get_food_type_display }}</h3>
                        <p>{{ spot.description|default:"No description" }}</p>
                        <time>üìÖ {{ spot.posted_at|date:"SHORT_DATETIME_FORMAT" }}</time>
                    </div>
                </div>
                {% empty %}
                <p style="text-align: center;">No food spots posted yet.</p>
                {% endfor %}
                </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([6.5244, 3.3792], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);

        const spots = [
            {% for spot in spots %}
        {
            lat: {{ spot.latitude }},
            lng: {{ spot.longitude }},
            food_type: "{{ spot.get_food_type_display }}",
                description: "{{ spot.description|escapejs }}",
                    posted_at: "{{ spot.posted_at|date:'SHORT_DATETIME_FORMAT' }}",
                        photo_url: "{% if spot.photo %}{{ spot.photo.url }}{% else %}''{% endif %}"
        } {% if not forloop.last %}, {% endif %}
        {% endfor %}
        ];

        spots.forEach(spot => {
            const marker = L.marker([spot.lat, spot.lng]).addTo(map);
            let popupContent = `<b>${spot.food_type}</b><br>${spot.description}<br><small>Posted at ${spot.posted_at}</small>`;
            if (spot.photo_url) {
                popupContent += `<br><img src="${spot.photo_url}" class="popup-img" alt="Food photo" width="100"/>`;
            }
            marker.bindPopup(popupContent);
        });
    </script>

</body>

</html>